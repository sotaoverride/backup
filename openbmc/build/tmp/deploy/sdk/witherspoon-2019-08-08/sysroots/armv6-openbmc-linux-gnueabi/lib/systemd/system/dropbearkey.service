[Unit]
Description=SSH Key Generation

[Service]
# Set the default RSA key path then load environment variables from the
# environment file, which might override the default RSA key path.
Environment="DROPBEAR_RSAKEY_DIR=/etc/dropbear"
EnvironmentFile=-/etc/default/dropbear
Type=oneshot
ExecStart=/bin/sh -c \
    "if [[ ! -f ${DROPBEAR_RSAKEY_DIR}/dropbear_rsa_host_key ]]; then \
        /bin/mkdir -p ${DROPBEAR_RSAKEY_DIR}; \
        /usr/sbin/dropbearkey -t rsa -f ${DROPBEAR_RSAKEY_DIR}/dropbear_rsa_host_key; \
     fi"
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
